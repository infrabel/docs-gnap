<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Sample node REST API</title>
    <meta name="description" content="The official GNaP documentation">
    <link rel="canonical" href="http://gnap-web-themes-docs.azurewebsites.net/appendix-1-sample-node-rest-api/">
    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <a href="https://github.com/infrabel/GNaP.Web.Themes"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/365986a132ccd6a44c23a9169022c0b5c890c387/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f7265645f6161303030302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"></a>
    <div class="container">
      <div class="row">
        <div class="col-md-3">
          <div class="list-group">
      <a href="/" class="list-group-item ">Getting Started</a>
      <a href="/application-structure" class="list-group-item ">Application structure</a>
      <a href="/configuring-your-application" class="list-group-item ">Configuring your application</a>
      <a href="/states-controllers-views" class="list-group-item ">States, controllers &amp; views</a>
      <a href="/working-with-a-rest-api" class="list-group-item ">Working with a REST API</a>
      <a href="/authenticating-using-a-jwt-token" class="list-group-item ">Authenticating using a JWT token</a>
      <a href="/internationalization" class="list-group-item ">Internationalization (I18n)</a>
      <a href="/validating-user-input" class="list-group-item ">Validating user input</a>
      <a href="/error-handling" class="list-group-item ">Error handling</a>
      <a href="/putting-your-application-in-production" class="list-group-item ">Putting your application in production</a>
      <a href="/troubleshooting-your-application" class="list-group-item ">Troubleshooting your application</a>
      <a href="/advanced-topics" class="list-group-item ">Advanced topics</a>
      <a href="/appendix-1-sample-node-rest-api" class="list-group-item active">Appendix 1: Sample node REST API</a>
</div>
        </div>
        <div class="col-md-8 col-md-offset-1 ">
          <div class="article">

  <header class="article-header">
    <h1>Sample node REST API</h1>
  </header>

  <article class="article-content">
  <p>Start by creating a new folder on your local disk.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">mkdir todo-api</code></pre></div>

<p>Open the folder you just created.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">cd todo-api</code></pre></div>

<p>Install <a href="http://mcavage.github.com/node-restify">restify</a>, a smallish framework, similar to express for building REST APIs. For full details, see <a href="http://mcavage.github.com/node-restify">http://mcavage.github.com/node-restify</a>.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">npm install restify</code></pre></div>

<p>Next you can start writing your NodeJS server. Create a file named <code>app.js</code> and paste the following code in it:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">'restify'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'/todos'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">([{</span>
        <span class="na">title</span><span class="p">:</span> <span class="s1">'Buy milk'</span>
    <span class="p">}]);</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'listening at %s'</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p>Run your server using the following command:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">node app.js</code></pre></div>

<p>Navigate to http://localhost:8080/todos using your browser. The server will return a list of todos in JSON format.</p>

<h2 id="enable-cors-cross-origin-resource-sharing">Enable CORS (Cross Origin Resource Sharing)</h2>

<p>Because of the <a href="http://en.wikipedia.org/wiki/Same-origin_policy">same origin policy</a> a browser will not allow a site hosted on http://my-domain.com to fetch data from an API hosted on http://other-domain.com. However, by supporting <a href="http://www.w3.org/TR/cors/">Cross Origin Resource Sharing (CORS)</a> requests, other-domain.com can add a few special response headers that allows my-domain.com to access the data.</p>

<p>Read more about CORS on the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">Mozilla Developer Network</a></p>

<p>We can enable CORS on our sample server by adding the following middleware just after <code>var server = restify.createServer();</code>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">,</span><span class="nx">next</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Origin"</span><span class="p">,</span> <span class="s2">"*"</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">"Access-Control-Allow-Headers"</span><span class="p">,</span> <span class="s2">"X-Requested-With"</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">);</span></code></pre></div>

<blockquote>
  <p>WARNING: The above code fragment is not safe as it doesnâ€™t restrict on the origin of the HTTP request. Replace the value of the Access-Control-Allow-Origin header with the domain you want to allow access.</p>
</blockquote>

  </article>

</div>
        </div>
      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
  </body>
</html>