<!DOCTYPE html>
<html lang="en" ng-app="docs">
    <head>
  <meta charset="utf-8" />
  <title>Working with a REST API - GNaP</title>

  <meta name="description" content="" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="/node_modules/gnap-theme-gnap-angular/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/font-awesome.min.css" />

  <!--[if IE 7]>
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/font-awesome-ie7.min.css" />
  <![endif]-->

  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/ace-fonts.min.css" />
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/ace.min.css" />
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/ace-skins.min.css" />
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/print.min.css" media="print" />

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/ace-ie.min.css" />
  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/ie8.min.css" />
  <![endif]-->

  <!--[if lt IE 9]>
  <script src="/node_modules/gnap-theme-gnap-angular/js/html5shiv.min.js"></script>
  <script src="/node_modules/gnap-theme-gnap-angular/js/respond.min.js"></script>
  <![endif]-->

  <link rel="stylesheet" href="/node_modules/gnap-theme-gnap-angular/css/ie9.min.css" />

  <link rel="stylesheet" href="/css/jekyll-syntax/default.css" />
  <link rel="stylesheet" href="/css/common.css" />
  <link rel="stylesheet" href="/css/docs.css" />

  <script src="/node_modules/gnap-theme-gnap-angular/js/modernizr.min.js"></script>

  <link href="/images/favicon.ico" rel="shortcut icon" type="image/x-icon" />
</head>


    <body>
        <div class="navbar navbar-default" id="navbar">
    <div class="navbar-container" id="navbar-container">
        <div class="navbar-header pull-left">
            <a href="/" class="navbar-brand">
                <small>
                    <i class="team-logo"></i>

                    <!-- GNaP -->
                </small>
            </a>
        </div>
        
        <div class="navbar-header pull-right" role="navigation">
            <ul class="nav ace-nav">
                <li><a href="/docs"><i class="icon-file"></i>Documentation</a></li>
                <li><a href="/"><i class="icon-youtube-play"></i> Videos</a></li>
                <li><a href="/releases"><i class="icon-tags"></i>Releases</a></li>
                <li><a href="/gnap/update/2014/12/09/introducing-gnap/"><i class="icon-file"></i>Blog</a></li>
                <li><a href="https://www.github.com/infrabel" target="_blank"><i class="icon-github"></i> GitHub</a></li>
            </ul>
        </div>
    </div>
</div>


        <div class="main-container" id="main-container">
            <div class="main-container-inner">
                <a class="menu-toggler" id="menu-toggler" href="#">
                    <span class="menu-text"></span>
                </a>
                <div class="sidebar" id="sidebar">
                    <ul class="nav nav-list">
    <li class="">
        <a href="/docs">
            <i class="icon-bolt"></i>
            <span class="menu-text"> Getting Started</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/application-structure">
            <i class="icon-tasks"></i>
            <span class="menu-text"> Application structure</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/configuring-your-application">
            <i class="icon-gears"></i>
            <span class="menu-text"> Configuring your application</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/states-controllers-views">
            <i class="icon-compass"></i>
            <span class="menu-text"> States, controllers &amp; views</span>
        </a>
    </li>
    <li class="active">
        <a href="/docs/working-with-a-rest-api">
            <i class="icon-code"></i>
            <span class="menu-text"> Working with a REST API</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/authenticating-using-a-jwt-token">
            <i class="icon-lock"></i>
            <span class="menu-text"> Authenticating using a JWT token</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/internationalization">
            <i class="icon-globe"></i>
            <span class="menu-text"> Internationalization (I18n)</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/validating-user-input">
            <i class="icon-check"></i>
            <span class="menu-text"> Validating user input</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/error-handling">
            <i class="icon-warning-sign"></i>
            <span class="menu-text"> Error handling</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/putting-your-application-in-production">
            <i class="icon-flag-checkered"></i>
            <span class="menu-text"> Putting your application in production</span>
        </a>
    </li>
    <li class="">
        <a href="/docs/troubleshooting-your-application">
            <i class="icon-terminal"></i>
            <span class="menu-text"> Troubleshooting your application</span>
        </a>
    </li>
</ul>

                </div>

                <div class="main-content">
                    <div class="breadcrumbs" id="breadcrumbs">
                        <ul class="breadcrumb">
                            <li>
                                <i class="icon-home home-icon"></i>
                                <a href="/">Home</a>
                            </li>
                            <li><a href="/docs">Documentation</a></lI>

                            <li class="active">Working with a REST API</li>
                        </ul>
                    </div>

                    <div class="page-content" ng-controller="TopicController" ng-cloak>
                        <div class="row">
                            <div class="col-xs-12">                             
                                <div class="page-header clearfix">
                                    <h1 class="pull-left">Working with a REST API</h1>
                                    <!--
                                    <div class="btn-group pull-right">
                                        <label class="btn btn-primary" ng-model="platform" btn-radio="'.NET'">.NET</label>
                                        <label class="btn btn-primary" ng-model="platform" btn-radio="'Java'">Java</label>
                                        <label class="btn btn-primary" ng-model="platform" btn-radio="'PHP'">PHP</label>
                                    </div>
                                    -->
                                </div>
                                <div class="alert alert-warning" platform="Java">
                                    <i class="icon-warning-sign"></i> We currently do not offer a server-side implementation for Java.
                                </div>
                                <div class="alert alert-warning" platform="PHP">
                                    <i class="icon-warning-sign"></i> We currently do not offer a server-side implementation for PHP.
                                </div>
                                <h2 id="about-rest">About REST</h2>

<p>Together with the rise of web 2.0 applications exposing an API came the trend of creating mashups for all kind of popular services. This fueled the demand for simple web APIs to replace the heavy ceremony-laden SOAP web services. In 2000 the term <em>representational state transfer</em> was introduced and developers quickly jumped on the bandwagon. REST goes back to the basics of the HTTP protocol and does away with the need of envelopes and other heavy SOAP protocol aspects. It operates at the HTTP level with URLs, accept headers and HTTP methods.</p>

<p>A big advantage of REST services is that every browser already has the needed tools and libraries to support them. That’s why JavaScript framework developers have embraced REST as the default protocol of talking with server resources. So did the developers of the AngularJS framework.</p>

<p>For a quick introduction to REST, visit this InfoQ article: <a href="http://www.infoq.com/articles/rest-introduction">A Brief Introduction to REST</a></p>

<h2 id="rest-example">REST Example</h2>

<p>If, for example, we would like to check the stock price of the <em>IBM</em> ticker symbol we would issue a request on the stock prices web API as follows:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">curl http://example.com/api/stockprices/ibm</code></pre></div>

<p>cURL would then issue the following request:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">GET /StockPrices/IBM HTTP/1.1
Host: www.example.org
Content-Type: application/json; charset=utf-8
Content-Length: nnn</code></pre></div>

<p>The server would come back with the following response:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">Content-Length: nnn
Content-Type: application/json; charset=utf-8

{ ticker-symbol: &#39;IBM&#39;, &#39;stock-price&#39;: 34.5 }</code></pre></div>

<blockquote>
  <p>cURL is a command line tool for transferring data with URL syntax, supporting the HTTP protocol. It comes in handy as a tool for testing a web API from the command line. It is installed by default on OS X and most Linux distros. If you’re on Windows you need to install it manually. Learn more at <a href="http://curl.haxx.se">http://curl.haxx.se</a></p>
</blockquote>

<h2 id="adding-a-resource-to-your-application">Adding a resource to your application</h2>

<p>Angular has built-in support for talking with a REST web API through the <a href="https://docs.angularjs.org/api/ngResource/service/$resource">ngResource</a> module. Although you can use the <code>$resource</code> service directly in your controllers it’s better to create a custom service for each of the resources you need to communicate with. This way the configuration of the resource is done in your custom service and can be changed in one location if needed.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">angular</span>
        <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;todo-app&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">factory</span><span class="p">(</span><span class="s1">&#39;Todo&#39;</span><span class="p">,</span> <span class="nx">Todo</span><span class="p">);</span>

    <span class="nx">Todo</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;$resource&#39;</span><span class="p">];</span>

    <span class="kd">function</span> <span class="nx">Todo</span><span class="p">(</span><span class="nx">$resource</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">$resource</span><span class="p">(</span><span class="s1">&#39;/api/todos&#39;</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">})();</span></code></pre></div>

<p>You can then query for a todo like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">Todo</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span><span class="mi">123</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// do something with the todo item</span>
<span class="p">});</span></code></pre></div>

<blockquote>
  <p>Note: we’ve included a sample REST API written in node. See <a href="/appendix-1-sample-node-rest-api">Appendix 1: Sample node REST API</a></p>
</blockquote>

<h2 id="using-the-resource-in-a-state">Using the resource in a state</h2>

<p>Usually you will want to display some data on a state. You can load this data in the controller but then your view will briefly show an empty list until the data is fully loaded. AngularUI Router has a way of pre-loading data so you can prevent this from happening.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">stateSettings</span> <span class="o">=</span> <span class="p">{</span>

    <span class="cm">/* ... */</span>

    <span class="nx">state</span><span class="o">:</span> <span class="p">{</span>

        <span class="cm">/* ... */</span>

        <span class="c1">// Add this to your state to pre-load data before the view is processed:</span>
        <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
            <span class="nx">todos</span><span class="o">:</span> <span class="nx">loadTodos</span>
        <span class="p">}</span>

    <span class="p">}</span>

    <span class="cm">/* ... */</span>
<span class="p">};</span>

<span class="nx">loadTodos</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todo&#39;</span><span class="p">];</span>

<span class="kd">function</span> <span class="nx">loadTodos</span><span class="p">(</span><span class="nx">todo</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">query</span><span class="p">().</span><span class="nx">$promise</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<p>Now AngularUI Router will load data from the REST API before performing the state transition.</p>

<h2 id="displaying-resource-data">Displaying resource data</h2>

<p>To display the data that was loaded in the state resolve function, we need to first change the controller function. The loaded data will be injected in the controller function using the Angular dependency injection mechanism. In order to be able to use that data in our view we need to assign it to the Angular scope.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="s1">&#39;use strict&#39;</span><span class="p">;</span>

<span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">angular</span>
        <span class="p">.</span><span class="nx">module</span><span class="p">(</span><span class="s1">&#39;todo-app&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">controller</span><span class="p">(</span><span class="s1">&#39;MainTodosController&#39;</span><span class="p">,</span> <span class="nx">MainTodosController</span><span class="p">);</span>

    <span class="c1">// tell Angular we&#39;re expecting to get the todos from the state engine</span>
    <span class="nx">MainTodosController</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;todos&#39;</span><span class="p">];</span>

    <span class="kd">function</span> <span class="nx">MainTodosController</span><span class="p">(</span><span class="nx">todos</span> <span class="cm">/* the todos loaded from the REST API */</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

        <span class="c1">// assign the todos to the scope so that we can access them from within the view</span>
        <span class="nx">vm</span><span class="p">.</span><span class="nx">todos</span> <span class="o">=</span> <span class="nx">todos</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">})();</span></code></pre></div>

<p>In our view we can then access the data from the <code>vm.todos</code> property.</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">&quot;table&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;thead&gt;</span>
        <span class="nt">&lt;tr&gt;</span>
            <span class="nt">&lt;th&gt;</span>Title<span class="nt">&lt;/th&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/thead&gt;</span>
    <span class="nt">&lt;tbody&gt;</span>
        <span class="nt">&lt;tr</span> <span class="na">ng-repeat=</span><span class="s">&quot;todo in vm.todos&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;td&gt;</span>{{ todo.title }}<span class="nt">&lt;/td&gt;</span>
        <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span></code></pre></div>

<h2 id="sample-node-rest-server">Sample node REST server</h2>

<p>Start by creating a new folder on your local disk.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">mkdir todo-api</code></pre></div>

<p>Open the folder you just created.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">cd todo-api</code></pre></div>

<p>Install <a href="http://mcavage.github.com/node-restify">restify</a>, a smallish framework, similar to express for building REST APIs. For full details, see <a href="http://mcavage.github.com/node-restify">http://mcavage.github.com/node-restify</a>.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">npm install restify</code></pre></div>

<p>Next you can start writing your NodeJS server. Create a file named <code>app.js</code> and paste the following code in it:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">restify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;restify&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">server</span> <span class="o">=</span> <span class="nx">restify</span><span class="p">.</span><span class="nx">createServer</span><span class="p">();</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/todos&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">([{</span>
        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Buy milk&#39;</span>
    <span class="p">}]);</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">server</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">8080</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;listening at %s&#39;</span><span class="p">,</span> <span class="nx">server</span><span class="p">.</span><span class="nx">url</span><span class="p">);</span>
<span class="p">});</span></code></pre></div>

<p>Run your server using the following command:</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">node app.js</code></pre></div>

<p>Navigate to http://localhost:8080/todos using your browser. The server will return a list of todos in JSON format.</p>

<h3 id="enable-cors-cross-origin-resource-sharing">Enable CORS (Cross Origin Resource Sharing)</h3>

<p>Because of the <a href="http://en.wikipedia.org/wiki/Same-origin_policy">same origin policy</a> a browser will not allow a site hosted on http://my-domain.com to fetch data from an API hosted on http://other-domain.com. However, by supporting <a href="http://www.w3.org/TR/cors/">Cross Origin Resource Sharing (CORS)</a> requests, other-domain.com can add a few special response headers that allows my-domain.com to access the data.</p>

<p>Read more about CORS on the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS">Mozilla Developer Network</a></p>

<p>We can enable CORS on our sample server by adding the following middleware just after <code>var server = restify.createServer();</code>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">server</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span>
  <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">,</span><span class="nx">next</span><span class="p">){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">header</span><span class="p">(</span><span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">,</span> <span class="s2">&quot;X-Requested-With&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">next</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">);</span></code></pre></div>

<blockquote>
  <p>WARNING: The above code fragment is not safe as it doesn’t restrict on the origin of the HTTP request. Replace the value of the Access-Control-Allow-Origin header with the domain you want to allow access.</p>
</blockquote>

                                
                                    <nav>
                                        <ul class="pager">
                                            <li class="next"><a href="/docs/authenticating-using-a-jwt-token">Next: Authenticating using a JWT token <span aria-hidden="true">&rarr;</span></a></li>
                                        </ul>
                                    </nav>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            window.jQuery || document.write("<script src='/node_modules/gnap-theme-gnap-angular/js/jquery.min.js'>"+"<"+"/script>");
        </script>
        <script type="text/javascript">
            if("ontouchend" in document) document.write("<script src='/node_modules/gnap-theme-gnap-angular/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
        </script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/bootstrap.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/ace-elements.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/ace.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/layout.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/angular/angular.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/angular/angular-resource.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/angular-local-storage/angular-local-storage.min.js"></script>
        <script src="/node_modules/gnap-theme-gnap-angular/js/ui-bootstrap/ui-bootstrap-tpls-0.11.0.min.js"></script>

        <script src="/js/app/docs/app.modules.js"></script>
        <script src="/js/app/docs/app.config.js"></script>
        <script src="/js/app/docs/topic.controller.js"></script>
        <script src="/js/app/docs/platform.directive.js"></script>
    </body>
</html>
